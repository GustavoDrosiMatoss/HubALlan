-- Allan Hub Arise - Auto Dungeon + Auto Castelo integrados
-- ConfiguraÃ§Ã£o persistente em allan_hub_config.json

local ReplicatedStorage = game:GetService("ReplicatedStorage")
local remote = ReplicatedStorage:WaitForChild("BridgeNet2"):WaitForChild("dataRemoteEvent")
local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- ğŸ“ ConfiguraÃ§Ã£o persistente
local configFile = "allan_hub_config.json"
local config = {}
if isfile(configFile) then
    config = HttpService:JSONDecode(readfile(configFile))
else
    config = {
        AutoDungeon = false,
        AutoCastelo = false,
        AutoLeave = false,
        AndarEntrada = 10,
        AndarSaida = 1
    }
end
local function salvarConfig() writefile(configFile,HttpService:JSONEncode(config)) end

-- ğŸ”¹ Auto Dungeon (aba jÃ¡ existe no Allan Hub: Tabs.dungeon)
local ativarDungeon = config.AutoDungeon

Tabs.dungeon:AddToggle("ToggleAutoDungeon", {
    Title = "Auto Dungeon",
    Default = config.AutoDungeon,
    Callback = function(state)
        config.AutoDungeon = state
        salvarConfig()
        ativarDungeon = state
        if state then
            print("âš”ï¸ Auto Dungeon ativado!")
            task.spawn(function()
                while ativarDungeon do
                    print("âš”ï¸ Farmando mobs da dungeon...")
                    task.wait(1)
                end
            end)
        else
            print("âŒ Auto Dungeon desativado!")
        end
    end
})
if config.AutoDungeon then
    task.spawn(function()
        while ativarDungeon do
            print("âš”ï¸ Farmando mobs da dungeon...")
            task.wait(1)
        end
    end)
end

-- ğŸ”¥ Criar aba separada: Auto Castelo
local ativarCastelo = config.AutoCastelo
local ativarAutoLeave = config.AutoLeave
local andarEntrada = config.AndarEntrada
local andarSaida = config.AndarSaida
local currentFloor = 0

Tabs.castelo = Window:AddTab({
    Title = "Castelo",
    Icon = "home"
})

-- Dropdowns
local valsEntrada,valsSaida={},{} 
for i=10,110,10 do table.insert(valsEntrada,tostring(i)) end 
for i=1,117 do table.insert(valsSaida,tostring(i)) end

Tabs.castelo:AddDropdown("AndarEntrada",{Title="Andar Entrada",Values=valsEntrada,Default=tostring(andarEntrada),Callback=function(v)andarEntrada=tonumber(v)config.AndarEntrada=andarEntrada salvarConfig()end})
Tabs.castelo:AddDropdown("AndarSaida",{Title="Andar SaÃ­da",Values=valsSaida,Default=tostring(andarSaida),Callback=function(v)andarSaida=tonumber(v)config.AndarSaida=andarSaida salvarConfig()end})

Tabs.castelo:AddToggle("ToggleAutoLeave",{Title="Auto Leave",Default=ativarAutoLeave,Callback=function(state)ativarAutoLeave=state config.AutoLeave=state salvarConfig()end})

-- FunÃ§Ãµes Castelo
local function entrarCastelo()
    local args = { [1] = { [1] = { ["Check"]=true,["Floor"]=tostring(andarEntrada),["Event"]="CastleAction",["Action"]="Join"},[2]="\\12"}}
    remote:FireServer(unpack(args))
    print("âœ… Entrando no andar",andarEntrada)
end
local function sairCastelo()
    local args = { [1] = { [1] = { ["Check"]=true,["Floor"]=tostring(andarSaida),["Event"]="CastleAction",["Action"]="LeaveDungeon"},[2]="\\12"}}
    remote:FireServer(unpack(args))
    print("âŒ Saindo no andar",andarSaida)
end
local function atacarMobsCastelo()
    while ativarCastelo do
        print("âš”ï¸ Farmando mobs do castelo...")
        task.wait(1)
    end
end

-- Monitorar andar e auto leave
remote.OnClientEvent:Connect(function(data)
    if typeof(data)=="table" and data[1] and data[1]["Event"]=="PortalAction" then
        local andar=tonumber(data[1]["Floor"])
        if andar then currentFloor=andar if ativarCastelo and ativarAutoLeave and andar==andarSaida then sairCastelo() end end
    end
end)

-- Toggle Auto Castelo
Tabs.castelo:AddToggle("ToggleAutoCastelo",{Title="Auto Castelo",Default=ativarCastelo,Callback=function(state)ativarCastelo=state config.AutoCastelo=state salvarConfig() if state then entrarCastelo() task.spawn(atacarMobsCastelo) else print("ğŸ›‘ Auto Castelo desativado!") end end})
if config.AutoCastelo then entrarCastelo() task.spawn(atacarMobsCastelo) end

-- ğŸ•’ Schedule: alternar dungeon/castelo nos horÃ¡rios certos
local function dentroIntervaloCastelo() local m=os.date("*t").min return (m>=15 and m<=30) or (m>=45 and m<=57) end
task.spawn(function()
    while true do
        if dentroIntervaloCastelo() and ativarDungeon then
            local args = { [1] = { [1] = { ["Check"]=true,["Event"]="DungeonAction",["Action"]="LeaveDungeon"},[2]="\\12"}}
            remote:FireServer(unpack(args))
            print("â¸ï¸ Dungeon pausada - horÃ¡rio de Castelo")
            ativarDungeon=false
            if config.AutoCastelo then entrarCastelo() task.spawn(atacarMobsCastelo) end
        end
        task.wait(10)
    end
end)
